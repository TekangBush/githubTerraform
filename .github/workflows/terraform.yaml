name: terraform workflow
on:
    push:
        branches: 
            - main
            - dev
    workflow_dispatch: 
env:
    ARM_CLIENT_ID: ${{secrets.ARM_CLIENT_ID}}
    ARM_CLIENT_SECRET: ${{secrets.ARM_CLIENT_SECRET}}
    ARM_SUBSCRIPTION_ID: ${{secrets.ARM_SUBSCRIPTION_ID}}
    ARM_TENANT_ID: ${{secrets.ARM_TENANT_ID}}
    TF_VAR_madic: ${{vars.APP_NAME}}
    TF_VAR_marc: ${{vars.APP_MARC}}
    TERRAFORM_VERSION: '1.10.4'
    TERRAFORM_WORKING_DIRECTORY: main


jobs:
    terraform:
        environment: 
            name: Dev
        runs-on: ubuntu-latest
        steps:
            - name: üçècheckout
              uses: actions/checkout@v2
            - name: üçèSetup Terraform
              uses: hashicorp/setup-terraform@v2
              with:
                terraform_version: ${{env.TERRAFORM_VERSION}}
                terraform_wrapper: false
                
            - name: üçè Terraform version
              run: |
               terraform --version
            - name: üçè Terraform init
              run: |
                terraform init 
              working-directory: ./${{env.TERRAFORM_WORKING_DIRECTORY}}
            - name: üçècall a sec
              run: |
                echo "${{env.ARM_CLIENT_ID}}"
            - name: üçè Terraform plan 
              run: |
                terraform plan 
              working-directory: ./${{env.TERRAFORM_WORKING_DIRECTORY}}
            - name: üçèterraform apply
              working-directory: ./${{env.TERRAFORM_WORKING_DIRECTORY}}
              run: |
                terraform apply -auto-approve 
            # - name: üçè Terraform destroy
            #   working-directory: ./${{env.TERRAFORM_WORKING_DIRECTORY}}
            #   run: |
            #     terraform destroy -auto-approve